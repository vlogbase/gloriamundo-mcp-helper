/**
 * Generates client/index.js so that CommonJS `require()` works in the pkg snapshot.
 * Run during CI *after* `npm ci`.
 */
import { writeFileSync, mkdirSync, existsSync } from 'node:fs';
import { dirname, join } from 'node:path';

const BASE = 'node_modules/@modelcontextprotocol/sdk/client';
const mjs = join(BASE, 'index.mjs');
const cjs = join(BASE, 'index.js');

if (existsSync(mjs)) {
  mkdirSync(dirname(cjs), { recursive: true });
  writeFileSync(
    cjs,
    `// Auto-generated by CI – converts ESM → CJS for pkg\n` +
      `const { createRequire } = require('module');\n` +
      `module.exports = createRequire(__filename)('./index.mjs');\n`,
    'utf8'
  );
  console.log('✅  Wrote client/index.js shim');
} else {
  console.error('❌  Expected client/index.mjs not found – check SDK version');
  process.exit(1);
}
